<!-- mobile/src/app/pages/settings/settings.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <ion-list>
    <ion-item
      lines="none"
      class="card"
      *ngFor="let h of (habits$ | async); trackBy: trackById"
    >
      <div class="row">
        <!-- Linke Spalte: Infos -->
        <div class="info">
          <div class="name">{{ h.name }}</div>

          <div class="streaks">
            <div class="line">
              Current&nbsp;streak:
              <span class="num" [style.color]="colorCurrent(h.id)">
                {{ currentStreak(h.id) }}
              </span>
            </div>
            <div class="line">
              Longest&nbsp;streak:
              <span class="num" [style.color]="colorLongest(h.id)">
                {{ longestStreak(h.id) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Rechte Spalte: Aktionen -->
        <div class="actions">
          <ion-button
            class="alarm"
            fill="clear"
            size="small"
            aria-label="Edit notifications"
            [routerLink]="['/edit-notifications', h.id]"
          >
            <ion-icon name="alarm-outline" slot="icon-only"></ion-icon>
          </ion-button>

          <ion-button
            class="reset"
            fill="clear"
            size="small"
            aria-label="Reset"
            (click)="onResetClick(h, $event)"
          >
            <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
          </ion-button>

          <ion-button
            class="delete"
            fill="clear"
            size="small"
            aria-label="Delete"
            (click)="confirmDelete(h.id, $event)"
          >
            âœ•
          </ion-button>
        </div>

        <!-- Zeile 2: Timeline (volle Breite) -->
        <div class="timeline-row">
          <app-checkin-timeline
            [completedDays]="h.completedDays || []"
            [period]="h.period"
            [target]="h.target"
            [daysBack]="0"
            [heightPx]="20"
            [stepPx]="6"
            [showMonthLabels]="true"
            [startDateIso]="h.createdAt"
          ></app-checkin-timeline>
        </div>
      </div>
    </ion-item>
  </ion-list>

  <!-- Delete-Alert -->
  <ion-alert
    [isOpen]="alertOpen"
    header="Delete permanently?"
    message="This habit will be removed."
    [buttons]="alertButtons"
    (didDismiss)="alertOpen = false"
  ></ion-alert>

  <!-- Reset-Confirm (einfach) -->
  <ion-alert
    [isOpen]="resetConfirmOpen"
    header="Reset this habit?"
    message="All data for this habit will be cleared. You can start again today."
    [buttons]="resetConfirmButtons"
    (didDismiss)="resetConfirmOpen = false"
  ></ion-alert>
</ion-content>
