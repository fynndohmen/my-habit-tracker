<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <ion-list>
    <ion-item
      lines="none"
      class="card"
      *ngFor="let h of (habits$ | async); trackBy: trackById"
    >
      <!-- GRID: 2 Reihen, 2 Spalten -->
      <div class="row">

        <!-- Spalte links (Zeile 1) -->
        <div class="info">
          <div class="name">{{ h.name }}</div>

          <div class="streaks">
            <div class="line">
              Current&nbsp;streak:
              <span class="num" [style.color]="colorCurrent(h.id)">
                {{ currentStreak(h.id) }}
              </span>
            </div>
            <div class="line">
              Longest&nbsp;streak:
              <span class="num" [style.color]="colorLongest(h.id)">
                {{ longestStreak(h.id) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Spalte rechts (Zeile 1) -->
        <div class="actions">
          <ion-button
            class="alarm"
            fill="clear"
            size="small"
            aria-label="Edit notifications"
            [routerLink]="['/edit-notifications', h.id]"
          >
            <ion-icon name="alarm-outline" slot="icon-only"></ion-icon>
          </ion-button>

          <ion-button
            class="reset"
            fill="clear"
            size="small"
            aria-label="Reset streak"
            (click)="onResetStreakClick(h, $event)"
          >
            <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
          </ion-button>

          <ion-button
            class="delete"
            fill="clear"
            size="small"
            aria-label="Delete"
            (click)="confirmDelete(h.id, $event)"
          >✕</ion-button>
        </div>

        <!-- ZEILE 2: Timeline IMMER unter allem, über volle Breite -->
        <div class="timeline-row">
          <app-checkin-timeline
            [completedDays]="h.completedDays || []"
            [daysBack]="90"
            [heightPx]="20">
          </app-checkin-timeline>
        </div>

      </div>
    </ion-item>
  </ion-list>

  <!-- Delete-Alert -->
  <ion-alert
    [isOpen]="alertOpen"
    header="Delete permanently?"
    message="This habit will be removed."
    [buttons]="alertButtons"
    (didDismiss)="alertOpen = false">
  </ion-alert>

  <!-- Reset: Auswahl -->
  <ion-alert
    [isOpen]="resetChoiceOpen"
    [header]="resetChoiceHeader"
    [message]="'Select one or both options below.'"
    [inputs]="resetChoiceInputs"
    [buttons]="resetChoiceButtons"
    (didDismiss)="proceedAfterChoiceIfAnyPublicAdapter()">
  </ion-alert>

  <!-- Reset: Bestätigung -->
  <ion-alert
    [isOpen]="resetConfirmOpen"
    [header]="resetConfirmHeader"
    [message]="resetConfirmMessage"
    [buttons]="resetConfirmButtons"
    (didDismiss)="resetConfirmOpen = false">
  </ion-alert>
</ion-content>
